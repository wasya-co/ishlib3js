{"version":3,"file":"bundle-api.js","sources":["../src/index-api.js"],"sourcesContent":["\nimport config from \"/config.js\"\nimport { C, logg } from '/bundle-shared.js';\n\nconst request = axios.create({\n  baseURL: config.apiOrigin\n})\n\nconst apiPaths  = {}\n\nconst useApi = () => {\n\n  let token\n  try {\n    token = localStorage.getItem(C.jwt_token)\n  } catch (err) {\n    logg(err, 'Api cannot access localStorage')\n  }\n  if (!token) { console.log(\"Warning: jwt_token is null.\") }\n\n  return {\n\n    getCities: ()   => request.get(`${config.apiOrigin}/api/cities`).then((r) => r.data),\n    getCity: (slug) => request.get(`${config.apiOrigin}/api/cities/view/${slug}`),\n    getGallery: (slug) => {\n      return request.get(`${config.apiOrigin}/api/galleries/view/${slug}?jwt_token=${token}`\n      ).then((r) => r.data.gallery)\n    },\n    getLeads: (props) => {\n      logg(props, 'getLeads()')\n      return request.get(`${config.apiOrigin}/api/leads/?jwt_token=${token}`\n      ).then((r) => r.data.items)\n    },\n    getLocation: (props) => { // _vp_ 2022-09-04\n      const {\n        newsitems_page: _npg,\n        slug,\n      } = props\n\n      return request.get(`/api/maps/view/${slug}?jwt_token=${token}&newsitems_page=${_npg}`\n      ).then(r => r.data).then(r => {\n        return r.map\n      }).catch((err) => {\n        return err\n      })\n    },\n\n    // @TODO: test: upon 401, return anon user. _vp_ 2022-08-15\n    getMyAccount: () => {\n      return request.post(`/api/my/account`, { jwt_token: token, }).then((r) => r.data).catch((err) => {\n        return C.anonUser\n      })\n    },\n\n    getPhoto: (slug) => request.get(`${config.apiOrigin}/api/photos/view/${slug}?jwt_token=${token}`).then((r) => r.data.photo),\n\n    getReport: (slug) => request.get(`${config.apiOrigin}/api/reports/view/${slug}?jwt_token=${token}`).then((r) => r.data.report),\n\n    getTag: (tag) => request.get(`${config.apiOrigin}/api/tags/view/${tag.slug}`).then((r) => r.data),\n\n    initPayment: (p) => request.post(`${config.apiOrigin}/api/payments2`, { jwt_token: token, amount_cents: p.amountCents }).then((r) => r.data),\n\n    longTermTokenPath: '/api/users/long_term_token', // @TODO: move to config.router _vp_ 2022-09-04\n\n    postLogin: ({ email, password }) => {\n      return request.post(`${config.apiOrigin}/api/users/login.json`, { user: { email, password }}\n      ).then((r) => r.data).then((r) => {\n        localStorage.setItem(C.jwt_token, r.jwt_token)\n        return r\n      })\n    },\n\n    myVideosPath: \"/api/my/videos\", // @TODO: remove\n\n    applicationHome: () => {\n      request.get(`${config.apiOrigin}/api/sites/view/${config.domain}`, { params: { jwt_token: token } }).then((r) => {\n        return r.data\n      })\n    },\n\n    vote: (props) => {\n      const { value, voter_id, votee_id, votee_class_name } = props\n      return request.post(\n        `${config.apiOrigin}/api/v1/vote/${votee_class_name}/${votee_id}/${voter_id}/${value}`,\n        { params: { jwt_token: token } }\n      ).then((r) => {\n        logg(r, 'voted')\n        return r\n      })\n    },\n\n    unvote: () => {\n      logg('Unvote is not implemented!')\n    },\n  }\n\n}\n\nexport default useApi\n"],"names":["request","axios","create","baseURL","config","apiOrigin","useApi","token","localStorage","getItem","C","jwt_token","err","logg","console","log","getCities","get","then","r","data","getCity","slug","getGallery","gallery","getLeads","props","items","getLocation","newsitems_page","_npg","map","catch","getMyAccount","post","anonUser","getPhoto","photo","getReport","report","getTag","tag","initPayment","p","amount_cents","amountCents","longTermTokenPath","postLogin","email","password","user","setItem","myVideosPath","applicationHome","domain","params","vote","value","voter_id","votee_id","votee_class_name","unvote"],"mappings":";;;AAIA,MAAMA,OAAO,GAAGC,KAAK,CAACC,MAAM,CAAC;EAC3BC,OAAO,EAAEC,MAAM,CAACC,SAAAA;AAClB,CAAC,CAAC,CAAA;AAIIC,MAAAA,MAAM,GAAGA,MAAM;AAEnB,EAAA,IAAIC,KAAK,CAAA;EACT,IAAI;IACFA,KAAK,GAAGC,YAAY,CAACC,OAAO,CAACC,CAAC,CAACC,SAAS,CAAC,CAAA;GAC1C,CAAC,OAAOC,GAAG,EAAE;AACZC,IAAAA,IAAI,CAACD,GAAG,EAAE,gCAAgC,CAAC,CAAA;AAC7C,GAAA;EACA,IAAI,CAACL,KAAK,EAAE;AAAEO,IAAAA,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC,CAAA;AAAC,GAAA;EAEzD,OAAO;IAELC,SAAS,EAAEA,MAAQhB,OAAO,CAACiB,GAAG,CAAE,GAAEb,MAAM,CAACC,SAAU,CAAY,WAAA,CAAA,CAAC,CAACa,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC;AACpFC,IAAAA,OAAO,EAAGC,IAAI,IAAKtB,OAAO,CAACiB,GAAG,CAAE,CAAEb,EAAAA,MAAM,CAACC,SAAU,CAAmBiB,iBAAAA,EAAAA,IAAK,EAAC,CAAC;IAC7EC,UAAU,EAAGD,IAAI,IAAK;MACpB,OAAOtB,OAAO,CAACiB,GAAG,CAAE,CAAA,EAAEb,MAAM,CAACC,SAAU,CAAsBiB,oBAAAA,EAAAA,IAAK,CAAaf,WAAAA,EAAAA,KAAM,EACrF,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAACI,OAAO,CAAC,CAAA;KAC9B;IACDC,QAAQ,EAAGC,KAAK,IAAK;AACnBb,MAAAA,IAAI,CAACa,KAAK,EAAE,YAAY,CAAC,CAAA;MACzB,OAAO1B,OAAO,CAACiB,GAAG,CAAE,GAAEb,MAAM,CAACC,SAAU,CAAA,sBAAA,EAAwBE,KAAM,CAAA,CACrE,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAACO,KAAK,CAAC,CAAA;KAC5B;IACDC,WAAW,EAAGF,KAAK,IAAK;AAAE;MACxB,MAAM;AACJG,QAAAA,cAAc,EAAEC,IAAI;AACpBR,QAAAA,IAAAA;AACF,OAAC,GAAGI,KAAK,CAAA;MAET,OAAO1B,OAAO,CAACiB,GAAG,CAAE,CAAA,eAAA,EAAiBK,IAAK,CAAaf,WAAAA,EAAAA,KAAM,CAAkBuB,gBAAAA,EAAAA,IAAK,CACpF,CAAA,CAAC,CAACZ,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAACF,IAAI,CAACC,CAAC,IAAI;QAC5B,OAAOA,CAAC,CAACY,GAAG,CAAA;AACd,OAAC,CAAC,CAACC,KAAK,CAAEpB,GAAG,IAAK;AAChB,QAAA,OAAOA,GAAG,CAAA;AACZ,OAAC,CAAC,CAAA;KACH;AAED;IACAqB,YAAY,EAAEA,MAAM;AAClB,MAAA,OAAOjC,OAAO,CAACkC,IAAI,CAAE,iBAAgB,EAAE;AAAEvB,QAAAA,SAAS,EAAEJ,KAAAA;AAAO,OAAC,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC,CAACY,KAAK,CAAEpB,GAAG,IAAK;QAC/F,OAAOF,CAAC,CAACyB,QAAQ,CAAA;AACnB,OAAC,CAAC,CAAA;KACH;IAEDC,QAAQ,EAAGd,IAAI,IAAKtB,OAAO,CAACiB,GAAG,CAAE,CAAEb,EAAAA,MAAM,CAACC,SAAU,CAAmBiB,iBAAAA,EAAAA,IAAK,CAAaf,WAAAA,EAAAA,KAAM,CAAC,CAAA,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAACiB,KAAK,CAAC;IAE3HC,SAAS,EAAGhB,IAAI,IAAKtB,OAAO,CAACiB,GAAG,CAAE,CAAEb,EAAAA,MAAM,CAACC,SAAU,CAAoBiB,kBAAAA,EAAAA,IAAK,CAAaf,WAAAA,EAAAA,KAAM,CAAC,CAAA,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAACmB,MAAM,CAAC;IAE9HC,MAAM,EAAGC,GAAG,IAAKzC,OAAO,CAACiB,GAAG,CAAE,CAAA,EAAEb,MAAM,CAACC,SAAU,CAAA,eAAA,EAAiBoC,GAAG,CAACnB,IAAK,CAAC,CAAA,CAAC,CAACJ,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC;AAEjGsB,IAAAA,WAAW,EAAGC,CAAC,IAAK3C,OAAO,CAACkC,IAAI,CAAE,CAAA,EAAE9B,MAAM,CAACC,SAAU,CAAA,cAAA,CAAe,EAAE;AAAEM,MAAAA,SAAS,EAAEJ,KAAK;MAAEqC,YAAY,EAAED,CAAC,CAACE,WAAAA;KAAa,CAAC,CAAC3B,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC;AAE5I0B,IAAAA,iBAAiB,EAAE,4BAA4B;AAAE;;AAEjDC,IAAAA,SAAS,EAAEA,CAAC;MAAEC,KAAK;AAAEC,MAAAA,QAAAA;AAAS,KAAC,KAAK;MAClC,OAAOjD,OAAO,CAACkC,IAAI,CAAE,GAAE9B,MAAM,CAACC,SAAU,CAAA,qBAAA,CAAsB,EAAE;AAAE6C,QAAAA,IAAI,EAAE;UAAEF,KAAK;AAAEC,UAAAA,QAAAA;AAAS,SAAA;AAAC,OAC3F,CAAC,CAAC/B,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC,CAACF,IAAI,CAAEC,CAAC,IAAK;QAChCX,YAAY,CAAC2C,OAAO,CAACzC,CAAC,CAACC,SAAS,EAAEQ,CAAC,CAACR,SAAS,CAAC,CAAA;AAC9C,QAAA,OAAOQ,CAAC,CAAA;AACV,OAAC,CAAC,CAAA;KACH;AAEDiC,IAAAA,YAAY,EAAE,gBAAgB;AAAE;;IAEhCC,eAAe,EAAEA,MAAM;AACrBrD,MAAAA,OAAO,CAACiB,GAAG,CAAE,CAAA,EAAEb,MAAM,CAACC,SAAU,CAAA,gBAAA,EAAkBD,MAAM,CAACkD,MAAO,CAAA,CAAC,EAAE;AAAEC,QAAAA,MAAM,EAAE;AAAE5C,UAAAA,SAAS,EAAEJ,KAAAA;AAAM,SAAA;AAAE,OAAC,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAK;QAC/G,OAAOA,CAAC,CAACC,IAAI,CAAA;AACf,OAAC,CAAC,CAAA;KACH;IAEDoC,IAAI,EAAG9B,KAAK,IAAK;MACf,MAAM;QAAE+B,KAAK;QAAEC,QAAQ;QAAEC,QAAQ;AAAEC,QAAAA,gBAAAA;AAAiB,OAAC,GAAGlC,KAAK,CAAA;AAC7D,MAAA,OAAO1B,OAAO,CAACkC,IAAI,CAChB,CAAA,EAAE9B,MAAM,CAACC,SAAU,CAAeuD,aAAAA,EAAAA,gBAAiB,IAAGD,QAAS,CAAA,CAAA,EAAGD,QAAS,CAAGD,CAAAA,EAAAA,KAAM,EAAC,EACtF;AAAEF,QAAAA,MAAM,EAAE;AAAE5C,UAAAA,SAAS,EAAEJ,KAAAA;AAAM,SAAA;AAAE,OACjC,CAAC,CAACW,IAAI,CAAEC,CAAC,IAAK;AACZN,QAAAA,IAAI,CAACM,CAAC,EAAE,OAAO,CAAC,CAAA;AAChB,QAAA,OAAOA,CAAC,CAAA;AACV,OAAC,CAAC,CAAA;KACH;IAED0C,MAAM,EAAEA,MAAM;MACZhD,IAAI,CAAC,4BAA4B,CAAC,CAAA;AACpC,KAAA;GACD,CAAA;AAEH;;;;"}